### 服务治理



### 服务注册



### 两个组件

Eureka Server 提供服务注册服务

各个微服务节点通过配置启动后，会在EurekaServer中进行注册，这样EurekaServer中的服务注册表中将会存储所有可用服务节点的信息，服务节点的信息可以在界面中直接看到



EurekaClient通过注册中心进行访问

是一个java客户端，用于简化EurekaServer的交互，客户端同时也是具备一个内置的、使用轮询(round-robin)负载算法的负载均衡器。在应用启动后，将会向EurekaServer发送心跳（默认30秒）。如果EurekaServer在多个心跳周期内没有接收到某个节点的心跳，EurekaServer将会向服务注册表中把这个服务节点移除（默认90秒）



### 集群原理说明

服务注册：将服务信息注册进注册中心

服务发现：从注册中心上获取服务信息

实质：存key服务名 取value调用地址

1.先启动Eureka注册中心

2.启动服务提供者payment支付服务

3.支付服务启动后会把自身信息（比如服务地址）以别名方式注册进Eureaka

4.消费者order服务在需要调用接口时，使用服务别名去注册中心获取实际的RPC远程调用地址

5.消费者获得调用地址后，底层实际是利用HttpClient技术实现远程调用

6.消费者获得服务地址后会缓存在本地jvm内存中，默认每间隔30秒更新一次服务调用地址



关注点 @LoadBalanced 注解原理(Ribbon负载均衡)



### 服务发现 

对于注册进eureka里面的微服务，可通过服务发现来获得该服务的信息



### 自我保护

Eureka Server将会尝试保护其服务注册表中的信息，不再删除服务注册表中的数据，也就是不会注销任何微服务。

某时刻某一个微服务不可用了，Eureka不会立刻清理，依旧会对该微服务的信息进行保存。

#### 为什么会产生自我保护机制？

为了防止EurekaClient可以正常运行，但是与EurekaServer网络不通情况下，EurekaServer不会立刻将EurekaClient服务剔除